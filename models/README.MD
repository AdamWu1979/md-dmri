#Implementation details

All functions that concerns a specific method is located in methods/name (folder currently named 'models' will be renamed to 'methods'). 
In that folder, a specific set of functions must be present that conforms to the following structure of the function call

```matlab
m = name_1d_data2fit(signal, xps, opt, ind)
```

Purpose: Fits a model to a signal. Input arguments are an 1D vector with signal values (```signal```), the 
experimental parameter structure xps (`xps`, see below), an option structure (`opt`) generated by `name_opt`, 
and an index vector `ind` that potentially subselects signal values. Output argument is a 1D vector with 
fitted model parameters (`m`), where the first should relate to the overall signal intensity.

```matlab
signal = name_1d_fit2data(m, xps)
```

Purpose: Predicts the signal. Input parameters are the model parameter vector, and the experimental parameter structure (`xps`). Output is the predicted signal vector (`signal`).


```matlab
mfs_fn = name_4d_data2fit(s, mfs_fn, opt)
```

Purpose: Fits a model to all data points. Input parameters are an input structure (`s`, see below), a model fit structure filename (`mfs_fn`), an an options structure (`opt`).


```matlab
dps = name_4d_fit2datam(mfs_fn, dps_fn, opt)
```

Purpose: Converts fitted model parameters to derived parameters (e.g. from a diffusion tensor fit to the fractional anisotropy). Input parameters are a model fit structure filename (`mfs_fn`), a derived parameter filename (`dps_fn`), and an options structure (`opt). Output is the derived parameter structure.


```matlab
name_check_xps(xps)
```

Purpose: Check that the `xps` contains all required fields.

```matlab
name_opt(opt)
```

Purpose: Adds necessary fields to the `opt` structure, but should not overwrite existing fields.


```matlab
name_plot(signal, xps, h, h2)
```

Purpose: Fits data and displays a plot. Input parameters are a signal vector (`signal`), an experimental parameter structure (`xps`), and two handles two figures (`h` and `h2`). 

## Experimental parameter and input structures
The experimental parameter structure (`xps`) contains fields that describe the experiment, for example, the b-value and the b-tensors. The input structure (`s`) contains references to a nifti file, potentially a mask, and the xps. More information is found at http://markus-nilsson.github.io/md-dmri/#p3

